
if(Aimbase===undefined){var Aimbase={};}
if(awaConfig===undefined){var awaConfig={};}
Aimbase.Analytics=(function(awaConfig){var MAX_PARAM_LEN=1024;var self=this;var clientId;var listeners=[];var lastPageVisitUid;var thisPageVisitUid;var currentSessionCookie;var currentScriptVersion="1.1.129.6695";var currentUserUidCookie="1cb55f0b-1dcb-4cc0-8655-2ca68a682a75";var config={cookieNamespace:'Aimbase.Analytics',sessionTimeout:20};var getScriptElement=function(){var el=document.getElementById('AimbaseAnalytics');return el;};var getScriptElementVariable=function(name){var el=getScriptElement();if(el&&el.tagName.toUpperCase()=='SCRIPT'&&el.hasAttribute(name)){return el.getAttribute(name);}
return null;};var setServiceUrl=function(){var el=getScriptElement();var re=el.src.match(/^http(s)?:\/\/[a-z0-9-\.]+(\.[a-z0-9-]+)*?(:[0-9]+)?(\/)?/i);if(re!=null)config.serviceAddress=re[0];};function mergeObjects(obj,override){var obj3={};for(var attrname in obj){obj3[attrname]=obj[attrname];}
for(var attrname in override){obj3[attrname]=override[attrname];}
return obj3;};var setCookie=function setCookie(name,value,minutes){if(minutes){var date=new Date();date.setTime(date.getTime()+(minutes*60*1000));var expires="; expires="+date.toGMTString();}
else
var expires="; expires="+new Date(2038,1,18).toGMTString();var dataDomain=getDomain();var domain="";if(dataDomain){domain=";domain="+dataDomain;}
document.cookie=config.cookieNamespace+"."+name+"="+(typeof value=="string"?value:JSON.stringify(value))+expires+domain+"; path=/";};var getCookie=function getCookie(name){var nameEQ=config.cookieNamespace+"."+name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')
c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)
try{return JSON.parse(c.substring(nameEQ.length,c.length));}catch(e){return c.substring(nameEQ.length,c.length);}}
return null;};var getDomain=function(){return getScriptElementVariable('data-domain');};var getManufacturer=function(){return getScriptElementVariable('data-mfg');};var getDealer=function(){return getScriptElementVariable('data-dealer');};var setClientId=function(){clientId=getScriptElementVariable('data-clientId');if(clientId===null)
throw'Could not find script element with id: "AimbaseAnalytics" and attribute: "data-clientId"';};var getParameterByName=function(name){name=name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return results==null?"":decodeURIComponent(results[1].replace(/\+/g," "));};var generateGUID=function(){var crypt=window.crypto||window.msCrypto;return crypt?([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,function(c){return(c^crypt.getRandomValues(new Uint8Array(1))[0]&15>>c/4).toString(16);}):'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c=='x'?r:(r&0x3|0x8);return v.toString(16);});};var serialize=function(obj,prefix,suffix){var str=[],p,key;for(p in obj){if(obj.hasOwnProperty(p)){key=p;if(Array.isArray(obj))
key="Array_"+p;var k=prefix?prefix+"["+key:key,s=prefix?suffix+"]":"";v=obj[p];str.push((v!==null&&typeof v==="object")?serialize(v,k,s):encodeURIComponent(k+s)+"="+encodeURIComponent(v));}}
result=str.join("&");if(result.length>MAX_PARAM_LEN&&obj.ref){var overage=result.length-MAX_PARAM_LEN;if(overage<obj.ref.length){var newRefLen=obj.ref.length-overage;obj.ref=obj.ref.substr(0,newRefLen);return serialize(obj);}}
return result;};var canUseSessionIdParameter=function(timeout,id){return id&&id!=''&&(!timeout||new Date()<new Date(parseInt(timeout)));};var isNewSession=function(sessionCookie,source,timeout){if(sessionCookie===null)
return true;if(source){if(!sessionCookie.source||sessionCookie.source.toUpperCase()!=source.toUpperCase())
return true;}
return false;};var setupSessionCookie=function setupSessionCookie(id,timeout){var sessionCookie=getCookie("Session");var parameters=getParameters();if(isNewSession(sessionCookie,parameters.source,timeout)){sessionCookie={id:canUseSessionIdParameter(timeout,id)?id:generateGUID()};for(var p in parameters){if(sessionCookie[p]===undefined&&parameters[p]){sessionCookie[p]=parameters[p];}}
sessionCookie.lpvid='';sessionCookie.ref=updateReferrer();}
setCookie("Session",sessionCookie,config.sessionTimeout||20);currentSessionCookie=sessionCookie;};var rotatePageVisitUid=function(current){var last=currentSessionCookie.lpvid;currentSessionCookie.lpvid=current;setCookie("Session",currentSessionCookie,config.sessionTimeout||20);return last;};var pageActionHandler=function(element,name,action,parameters,type,category,callback){var elementId=null;if(element!=undefined&&typeof element=='object'&&element.id!==undefined){elementId=element.id;}
sendPageAction(elementId,name,action,parameters,type,category,callback);};var sendPageAction=function(elementId,name,action,parameters,type,category,callback){var actionObject={};if(parameters!==undefined&&parameters!==null){if(typeof parameters==='object'){actionObject.params=encodeURIComponent(serialize(parameters));}else if(typeof parameters=='string'){actionObject.params=encodeURIComponent(serialize({string:parameters}));}}
if(elementId!=undefined&&elementId!=null){actionObject.element=elementId;}
if(name!=undefined&&name!=null)
actionObject.name=name.substring(0,100);if(type!=undefined&&type!=null)
actionObject.type=type.substring(0,100);if(category!=undefined&&category!=null)
actionObject.category=category.substring(0,100);actionObject.pvid=thisPageVisitUid;if(action!=undefined&&action!=null)
actionObject.action=action.substring(0,100);actionObject.paid=generateGUID();pushData(actionObject,"api/pageaction");if(callback){callback(actionObject);}};var getParameters=function(){var parmsObject=getWstQueryStringValues();parmsObject.event=getParameterByName('event');parmsObject.medium=getParameterByName('utm_medium');parmsObject.campaign=getParameterByName('utm_campaign');parmsObject.source=getParameterByName('utm_source');parmsObject.term=getParameterByName('utm_term');parmsObject.content=getParameterByName('utm_content');parmsObject.ref=getReferrer();return parmsObject;};var updateReferrer=function(){if(typeof currentSessionCookie!=="undefined"){delete currentSessionCookie.ref
currentSessionCookie.ref=getReferrer();return currentSessionCookie.ref;}else{return getReferrer();}};var getReferrer=function(){if(typeof currentSessionCookie!=="undefined"&&currentSessionCookie.ref)
return currentSessionCookie.ref;var referrer=getParameterByName('ref');if(!referrer){referrer=document.referrer;}
return referrer;};var trackPageVisit=function(callback){var trackingObject=getParameters();if(currentSessionCookie.lpvid)delete trackingObject.ref;thisPageVisitUid=generateGUID();lastPageVisitUid=rotatePageVisitUid(thisPageVisitUid);trackingObject.uid=currentUserUidCookie;trackingObject.title=document.title.substring(0,100);pushData(trackingObject,"api/pagevisit",callback);};var pushData=function pushData(paramObject,path,callback){var img;paramObject.cid=clientId;paramObject.ver=currentScriptVersion;paramObject.pvid=thisPageVisitUid;paramObject.lpvid=lastPageVisitUid;paramObject.rand=Math.random();paramObject.sid=currentSessionCookie.id;paramObject.pageUrl=encodeURIComponent(window.location.href);var mfg=getManufacturer();if(mfg!==null){paramObject.mfg=mfg;}
var dealer=getDealer();if(dealer!==null){paramObject.dealer=dealer;}
img=new Image(1,1);img.src=config.serviceAddress+path+"?"+serialize(paramObject);img.onload=function onImgLoad(){if(callback!=undefined&&typeof callback=="function")callback();}};var getWstQueryStringValues=function getWstQueryStringValues(){var vars={},hash;var workingName;var hashes=window.location.search.substr(1).split('&');for(var i=0;i<hashes.length;i++){hash=hashes[i].split('=');workingName=hash[0].toLowerCase();if(workingName.lastIndexOf('wst_',0)===0){vars[hash[0]]=hash[1];}}
return vars;};var getUserProductSegmentDetails=function(userUid,dataClientId,callback){var paramsObject={};if(userUid!=undefined&&userUid!=null)
paramsObject.WebUserId=userUid;else
throw'UserUid is required.'
if(dataClientId!=undefined&&dataClientId!=null)
paramsObject.ClientId=dataClientId;else
throw'ClientId is required.'
postData(paramsObject,'api/'+dataClientId+'/WebUserProductSegment',callback)};var postData=function postData(paramObject,path,callback){var url=config.serviceAddress+path;var xhr=new XMLHttpRequest();xhr.open("POST",url,true);xhr.setRequestHeader('Content-Type','application/json');xhr.onreadystatechange=function(){if(xhr.readyState==4){if(callback!=undefined&&typeof callback=="function")
callback(xhr.responseText);else
return xhr.responseText;}};xhr.send(JSON.stringify(paramObject));};var init=function init(){setClientId();setServiceUrl();if(awaConfig){config=mergeObjects(config,awaConfig);}
setupSessionCookie(getParameterByName('wst_session'),getParameterByName('wst_timeout'));trackPageVisit();};init();return{GetUserUid:function(){return currentUserUidCookie;},GetSessionUid:function(){return currentSessionCookie.id;},SendPageAction:function(elementId,name,action,parameters,callback){sendPageAction(elementId,name,action,parameters,callback);},AddListener:function(element,name,action,parameters,type,category,callback){if(!element)throw'element not defined';var listener={element:element,action:action,handler:function(e){pageActionHandler(element,name,action,parameters,type,category,callback);}};if(element.addEventListener){element.addEventListener(action,listener.handler,false);}
else if(element.attachEvent){element.attachEvent(action,listener.handler);}
else throw'Cannot attach event handler to element';listeners.push(listener);},RemoveListener:function(element,action){if(!element)throw'element not defined';var listener;for(var i=0;i<listeners.length;i++){if(listeners[i].element==element&&listeners[i].action==action){listener=listeners[i];listeners.splice(i,1);break;}}
if(listener){if(element.removeEventListener){element.removeEventListener(action,listener.handler,false);}
else if(element.detachEvent){element.detachEvent(action,listener.handler);}
else throw'Cannot detach event handler from element';}},GetFieldValue:function(name){if(name=='UserUid'){return this.GetUserUid();}
else if(name=='SessionUid'){return this.GetSessionUid();}
else if(name=='ClientId'){return clientId;}
else if(currentSessionCookie[name]!=undefined){return currentSessionCookie[name];}},GetUserProductSegmentDetailsTest:function(userUid,clientid,callback){getUserProductSegmentDetails(userUid,clientid,callback);},GetUserProductSegmentDetails:function(callback){var userUid=this.GetUserUid();if(userUid==undefined||userUid==null)
throw'userUid not defined'
var clientid=this.GetFieldValue('ClientId');if(clientid==undefined||clientid==null)
throw'clientid not defined'
getUserProductSegmentDetails(userUid,clientid,callback);},SetUserUid:function(uid){setCookie("User",uid,config.sessionTimeout||20);currentUserUidCookie=uid;setCookie("Session",null,config.sessionTimeout||20);setupSessionCookie();trackPageVisit();}};})(awaConfig);Aimbase.Capture=(function(awaConfig){var sendPageAction=function(pageAction){Aimbase.Analytics.SendPageAction(null,null,'capture',pageAction,null);};var getArrayArg=function(args){if(args&&args.length>0&&Array.isArray(args[0])){return args[0];}
return null;};return{SendProfile:function(firstName,lastName,email,countryCode,postalCode,address1,address2,city,state,homePhone,mobilePhone,workPhone,textOptIn,emailOptIn){this.Start().AddProfile(firstName,lastName,email,countryCode,postalCode,address1,address2,city,state,homePhone,mobilePhone,workPhone,textOptIn,emailOptIn).Send();},SendDealer:function(dealerNumber,dealerLocation,manufacturerCode){this.Start().AddDealer(dealerNumber,dealerLocation,manufacturerCode).Send();},SendProduct:function(code,name,modelYear,brandCode,manufacturerCode){this.Start().AddProduct(code,name,modelYear,brandCode,manufacturerCode).Send();},SendProductType:function(name){this.Start().AddProductType(name).Send();},SendSegment:function(name){this.Start().AddSegment(name).Send();},SendCampaign:function(name){this.Start().AddCampaign(name).Send();},SendLeadForm:function(leadType){this.Start().AddLeadForm(leadType).Send();},SendPageCategory:function(code){this.Start().AddPageCategory(code).Send();},SendTag:function(name,value){this.Start().AddTag(name,value).Send();},Start:function(){var fluent={pageAction:{},CleanObj:function(obj){Object.keys(obj).forEach(function(key){return obj[key]===undefined&&delete obj[key]});},Send:function(){sendPageAction(this.pageAction);},AddProfile:function(firstName,lastName,email,countryCode,postalCode,address1,address2,city,state,homePhone,mobilePhone,workPhone,textOptIn,emailOptIn){this.pageAction.profile={"firstName":firstName,"lastName":lastName,"email":email,"countryCode":countryCode,"postalCode":postalCode,"address1":address1,"address2":address2,"city":city,"state":state,"homePhone":homePhone,"mobilePhone":mobilePhone,"workPhone":workPhone,"textOptIn":textOptIn,"emailOptIn":emailOptIn};this.CleanObj(this.pageAction.profile);return fluent;},AddDealer:function(dealerNumber,dealerLocation,manufacturerCode){this.pageAction.dealer={"dealerNumber":dealerNumber,"dealerLocation":dealerLocation,"manufacturerCode":manufacturerCode};this.CleanObj(this.pageAction.dealer);return fluent;},AddProduct:function(code,name,modelYear,brandCode,manufacturerCode){if(this.pageAction.products===undefined)
this.pageAction.products=[];var product={"code":code,"name":name,"modelYear":modelYear,"brandCode":brandCode,"manufacturerCode":manufacturerCode};this.CleanObj(product);this.pageAction.products.push(product);return fluent;},AddProductType:function(name){if(this.pageAction.productTypes===undefined)
this.pageAction.productTypes=[];this.pageAction.productTypes.push(name);return fluent;},AddSegment:function(name){if(this.pageAction.segments===undefined)
this.pageAction.segments=[];this.pageAction.segments.push(name);return fluent;},AddCampaign:function(name){if(this.pageAction.campaigns===undefined)
this.pageAction.campaigns=[];this.pageAction.campaigns.push(name);return fluent;},AddLeadForm:function(leadType){if(this.pageAction.leadForm===undefined)
this.pageAction.leadForm={};this.pageAction.leadForm.leadType=leadType;return fluent;},AddPageCategory:function(code){this.pageAction.pageCategory=code;return fluent;},AddTag:function(name,value){if(this.pageAction.tags===undefined)
this.pageAction.tags={};this.pageAction.tags[name]=value;return fluent;}};return fluent;}};})(awaConfig);